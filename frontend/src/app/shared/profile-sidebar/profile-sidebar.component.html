<!-- Guest Sidebar - Show CTA for non-logged in users -->
<div class="profile-sidebar guest-sidebar" *ngIf="!loading && !isLoggedIn">
  <div class="guest-content">
    <div class="guest-icon">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
        <circle cx="12" cy="7" r="4"/>
      </svg>
    </div>
    <h3 class="guest-title">Join Our Platform</h3>
    <p class="guest-text">Create a free account to apply for jobs or post projects.</p>
    <div class="guest-actions">
      <a routerLink="/register" class="btn-gradient btn-sm btn-block">Sign Up Free</a>
      <a routerLink="/login" class="btn-dark-secondary btn-sm btn-block">Log In</a>
    </div>
  </div>
</div>

<!-- Authenticated User Sidebar -->
<div class="profile-sidebar" *ngIf="!loading && isLoggedIn && user">
  <div class="sidebar-header">
    <div class="avatar">
      <img *ngIf="profile?.photo_url" [src]="profile.photo_url" [alt]="getDisplayName()" />
      <span *ngIf="!profile?.photo_url" class="initials">{{ getInitials() }}</span>
    </div>
    <div class="user-info">
      <h3 class="name">{{ getDisplayName() }}</h3>
      <p class="headline" *ngIf="profile?.headline">{{ profile.headline }}</p>
    </div>
  </div>

  <div class="sidebar-body">
    <!-- Freelancer Stats -->
    <ng-container *ngIf="isFreelancer && freelancerStats">
      <!-- Availability badge -->
      <div class="availability-badge" [ngClass]="getAvailabilityClass()">
        <span class="dot"></span>
        {{ getAvailabilityLabel() }}
      </div>

      <!-- Stats Grid -->
      <div class="stats-grid">
        <div class="stat-item" *ngIf="freelancerStats.hourly_rate">
          <span class="stat-value">${{ freelancerStats.hourly_rate }}</span>
          <span class="stat-label">Per Hour</span>
        </div>
        <div class="stat-item">
          <span class="stat-value">{{ freelancerStats.jobs_completed || 0 }}</span>
          <span class="stat-label">Jobs Done</span>
        </div>
        <div class="stat-item" *ngIf="freelancerStats.rating">
          <span class="stat-value">⭐ {{ formatRating(freelancerStats.rating) }}</span>
          <span class="stat-label">{{ freelancerStats.reviews_count }} reviews</span>
        </div>
        <div class="stat-item" *ngIf="freelancerStats.experience_level">
          <span class="stat-value experience">{{ getExperienceLabel() }}</span>
          <span class="stat-label">Experience</span>
        </div>
      </div>
    </ng-container>

    <!-- Employer Stats -->
    <ng-container *ngIf="isEmployer && employerStats">
      <div class="company-info" *ngIf="employerStats.company_name">
        <span class="company-name">{{ employerStats.company_name }}</span>
        <span class="company-industry" *ngIf="employerStats.industry">{{ employerStats.industry }}</span>
      </div>

      <!-- Stats Grid -->
      <div class="stats-grid">
        <div class="stat-item">
          <span class="stat-value">{{ employerStats.jobs_posted || 0 }}</span>
          <span class="stat-label">Jobs Posted</span>
        </div>
        <div class="stat-item" *ngIf="employerStats.total_spent && employerStats.total_spent > 0">
          <span class="stat-value">${{ employerStats.total_spent | number:'1.0-0' }}</span>
          <span class="stat-label">Total Spent</span>
        </div>
        <div class="stat-item" *ngIf="employerStats.rating">
          <span class="stat-value">⭐ {{ formatRating(employerStats.rating) }}</span>
          <span class="stat-label">{{ employerStats.reviews_count }} reviews</span>
        </div>
      </div>
    </ng-container>

    <!-- Location -->
    <div class="info-item" *ngIf="profile?.location">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
        <circle cx="12" cy="10" r="3"/>
      </svg>
      <span>{{ profile.location }}</span>
    </div>

    <!-- Skills (freelancer only) -->
    <div class="skills-section" *ngIf="isFreelancer && profile?.skills?.length">
      <h4>Skills</h4>
      <div class="skills-list">
        <span class="skill-tag" *ngFor="let skill of profile.skills?.slice(0, 5)">{{ skill }}</span>
        <span class="skill-more" *ngIf="profile.skills && profile.skills.length > 5">
          +{{ profile.skills.length - 5 }} more
        </span>
      </div>
    </div>
  </div>

  <div class="sidebar-footer">
    <a routerLink="/profile" class="edit-profile-link">
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
      </svg>
      Edit Profile
    </a>
  </div>
</div>

<div class="profile-sidebar skeleton" *ngIf="loading">
  <div class="skeleton-avatar"></div>
  <div class="skeleton-line"></div>
  <div class="skeleton-line short"></div>
</div>
