<div class="admin-users">
  <header class="page-header">
    <div class="header-content">
      <h1 class="page-title">User Management</h1>
      <p class="page-subtitle">Manage users, roles, and access</p>
    </div>
  </header>

  <app-alert-message [message]="successMessage" type="success"></app-alert-message>
  <app-alert-message [message]="errorMessage" type="error"></app-alert-message>

  <div class="filters-bar">
    <div class="search-box">
      <mat-icon>search</mat-icon>
      <input type="text"
             placeholder="Search by email..."
             [(ngModel)]="searchQuery"
             (input)="onSearchChange()">
    </div>

    <div class="filter-group">
      <select [(ngModel)]="roleFilter" (change)="onFilterChange()">
        <option value="">All Roles</option>
        <option *ngFor="let role of roles" [value]="role">{{ role }}</option>
      </select>
    </div>
  </div>

  <div class="table-container" *ngIf="!loading">
    <table class="data-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Email</th>
          <th>Role</th>
          <th>Joined</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of filteredUsers" [class.blocked]="user.is_blocked">
          <td class="id-cell">#{{ user.user_id }}</td>
          <td class="email-cell">{{ user.email }}</td>
          <td>
            <span class="role-badge" [ngClass]="user.main_role.toLowerCase()">{{ user.main_role }}</span>
          </td>
          <td class="date-cell">{{ dateService.format(user.created_at, 'date') }}</td>
          <td class="actions-cell">
            <select class="role-select"
                    [value]="user.main_role"
                    (change)="assignRole(user, $any($event.target).value)"
                    [disabled]="!canEditUser(user)"
                    title="Change role">
              <option *ngFor="let role of getAvailableRoles()" [value]="role">{{ role }}</option>
            </select>
            <button class="action-btn"
                    *ngIf="!user.is_blocked && canEditUser(user)"
                    (click)="blockUser(user)"
                    title="Block user">
              <mat-icon>block</mat-icon>
            </button>
            <button class="action-btn success"
                    *ngIf="user.is_blocked && canEditUser(user)"
                    (click)="unblockUser(user)"
                    title="Unblock user">
              <mat-icon>check_circle</mat-icon>
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <app-empty-state *ngIf="filteredUsers.length === 0" icon="people_outline" title="No users found"></app-empty-state>
  </div>

  <app-loading-state *ngIf="loading" message="Loading users..."></app-loading-state>
</div>
