<div class="browse-page">
  <!-- Header -->
  <header class="page-header">
    <div class="header-inner">
      <div class="header-text">
        <h1 class="page-title">Find Your Next Project</h1>
        <p class="page-subtitle">{{ jobs.length }} job{{ jobs.length !== 1 ? 's' : '' }} available</p>
      </div>
    </div>
  </header>

  <div class="page-body">
    <div class="page-inner">
      <div class="content-layout">
        <!-- Main Content -->
        <div class="main-content">
          <!-- Filters Bar -->
          <div class="filters-bar">
            <div class="search-wrapper">
              <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/>
                <path d="M21 21l-4.35-4.35"/>
              </svg>
              <input 
                type="text" 
                class="search-input"
                [(ngModel)]="searchQuery"
                placeholder="Search jobs..."
                (keyup.enter)="onSearch()"
              />
            </div>

            <div class="filter-group">
              <select class="filter-select" 
                      [ngModel]="selectedCategory" 
                      (ngModelChange)="onCategoryChange($event)">
                <option [ngValue]="null">All Categories</option>
                <option *ngFor="let cat of categories" [ngValue]="cat.category_id">
                  {{ cat.name }}
                </option>
              </select>
            </div>

            <button class="filter-toggle-btn" (click)="toggleFilters()" [class.active]="showFilters">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
              </svg>
              Filters
              <span class="filter-count" *ngIf="getActiveFilterCount() > 0">{{ getActiveFilterCount() }}</span>
            </button>

            <button class="clear-btn" *ngIf="hasActiveFilters()" (click)="clearFilters()">
              Clear All
            </button>
          </div>

          <!-- Extended Filters Panel -->
          <div class="filters-panel" *ngIf="showFilters">
            <div class="filter-row">
              <div class="filter-group">
                <label>Status</label>
                <select class="filter-select" 
                        [(ngModel)]="selectedStatus" 
                        (ngModelChange)="onStatusChange($event)">
                  <option value="">All Status</option>
                  <option value="Open">Open</option>
                  <option value="In Progress">In Progress</option>
                </select>
              </div>

              <div class="filter-group">
                <label>Experience Level</label>
                <select class="filter-select" 
                        [(ngModel)]="selectedExperience" 
                        (ngModelChange)="onExperienceChange($event)">
                  <option value="">Any Level</option>
                  <option value="entry">Entry Level</option>
                  <option value="intermediate">Intermediate</option>
                  <option value="expert">Expert</option>
                </select>
              </div>

              <div class="filter-group">
                <label>Project Type</label>
                <select class="filter-select" 
                        [(ngModel)]="selectedJobType" 
                        (ngModelChange)="onJobTypeChange($event)">
                  <option value="">Any Type</option>
                  <option value="fixed">Fixed Price</option>
                  <option value="hourly">Hourly Rate</option>
                </select>
              </div>

              <div class="filter-group checkbox-group">
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="remoteOnly" (ngModelChange)="onRemoteChange($event)" />
                  <span class="checkmark"></span>
                  Remote Only
                </label>
              </div>
            </div>
          </div>

          <!-- Loading -->
          <div class="loading-state" *ngIf="loading">
            <div class="spinner"></div>
            <p>Loading jobs...</p>
          </div>

          <!-- Empty State -->
          <div class="empty-state" *ngIf="!loading && jobs.length === 0">
            <div class="empty-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <rect x="2" y="7" width="20" height="14" rx="2" ry="2"/>
                <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>
              </svg>
            </div>
            <h3>No jobs found</h3>
            <p>Try adjusting your search or filters to find more opportunities</p>
            <button class="btn-primary" (click)="clearFilters()">Clear Filters</button>
          </div>

          <!-- Jobs Grid -->
          <div class="jobs-grid" *ngIf="!loading && jobs.length > 0">
            <div class="job-card" *ngFor="let job of jobs" (click)="onViewJob(job)">
              <div class="card-top">
                <span class="job-category">{{ getCategoryName(job.category_id) }}</span>
                <div class="card-badges">
                  <span class="remote-badge" *ngIf="job.is_remote">üåç Remote</span>
                  <span class="job-status" [class]="job.status.toLowerCase().replace(' ', '-')">
                    {{ job.status }}
                  </span>
                </div>
              </div>

              <h3 class="job-title">{{ job.title }}</h3>
              
              <p class="job-description">
                {{ job.description | slice:0:180 }}{{ job.description.length > 180 ? '...' : '' }}
              </p>

              <!-- Job Tags -->
              <div class="job-tags" *ngIf="job.experience_level || job.job_type || (job.skills && job.skills.length)">
                <span class="tag experience" *ngIf="job.experience_level">{{ getExperienceLabel(job.experience_level) }}</span>
                <span class="tag job-type" *ngIf="job.job_type">{{ getJobTypeLabel(job.job_type) }}</span>
                <span class="tag skill" *ngFor="let skillId of (job.skills || []).slice(0, 3)">
                  {{ getSkillName(skillId) }}
                </span>
                <span class="tag more" *ngIf="job.skills && job.skills.length > 3">
                  +{{ job.skills.length - 3 }} more
                </span>
              </div>

              <div class="card-bottom">
                <div class="job-info">
                  <span class="info-item budget" *ngIf="job.budget">
                    {{ formatBudget(job.budget) }}
                  </span>
                  <span class="info-item location" *ngIf="job.location && !job.is_remote">
                    üìç {{ job.location }}
                  </span>
                  <span class="info-item deadline" *ngIf="job.deadline">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                      <line x1="16" y1="2" x2="16" y2="6"/>
                      <line x1="8" y1="2" x2="8" y2="6"/>
                      <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                    {{ job.deadline | date:'MMM d' }}
                  </span>
                </div>
                <span class="apply-link">View Details ‚Üí</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Profile Sidebar -->
        <aside class="profile-sidebar-wrapper">
          <app-profile-sidebar></app-profile-sidebar>
        </aside>
      </div>
    </div>
  </div>
</div>

<!-- Auth Prompt Modal -->
<app-auth-prompt-modal
  [show]="showAuthModal"
  title="Sign in to view job details"
  message="Create a free account or log in to view job details and apply for this opportunity."
  returnUrl="/find-work/browse"
  (closed)="closeAuthModal()">
</app-auth-prompt-modal>
