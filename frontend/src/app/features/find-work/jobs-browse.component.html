<div class="browse-page">
  <!-- Header -->
  <header class="page-header">
    <div class="header-inner">
      <div class="header-text">
        <h1 class="page-title">Find Your Next Project</h1>
        <p class="page-subtitle">{{ jobs.length }} job{{ jobs.length !== 1 ? 's' : '' }} available</p>
      </div>
    </div>
  </header>

  <div class="page-body">
    <div class="page-inner">
      <div class="content-layout">
        <!-- Main Content -->
        <div class="main-content">
          <!-- Filters Bar -->
          <div class="filters-bar">
            <div class="search-wrapper">
              <mat-icon class="search-icon">search</mat-icon>
              <input 
                type="text" 
                class="search-input"
                [(ngModel)]="searchQuery"
                placeholder="Search jobs..."
                (keyup.enter)="onSearch()"
              />
            </div>

            <div class="filter-group">
              <select class="filter-select" 
                      [ngModel]="selectedCategory" 
                      (ngModelChange)="onCategoryChange($event)">
                <option [ngValue]="null">All Categories</option>
                <option *ngFor="let cat of categories" [ngValue]="cat.category_id">
                  {{ cat.name }}
                </option>
              </select>
            </div>

            <button class="filter-toggle-btn" (click)="toggleFilters()" [class.active]="showFilters">
              <mat-icon>filter_list</mat-icon>
              Filters
              <span class="filter-count" *ngIf="getActiveFilterCount() > 0">{{ getActiveFilterCount() }}</span>
            </button>

            <button class="clear-btn" *ngIf="hasActiveFilters()" (click)="clearFilters()">
              Clear All
            </button>
          </div>

          <!-- Extended Filters Panel -->
          <div class="filters-panel" *ngIf="showFilters">
            <div class="filter-row">
              <div class="filter-group">
                <label>Status</label>
                <select class="filter-select" 
                        [(ngModel)]="selectedStatus" 
                        (ngModelChange)="onStatusChange($event)">
                  <option value="">All Status</option>
                  <option value="Open">Open</option>
                  <option value="In Progress">In Progress</option>
                </select>
              </div>

              <div class="filter-group">
                <label>Experience Level</label>
                <select class="filter-select" 
                        [(ngModel)]="selectedExperience" 
                        (ngModelChange)="onExperienceChange($event)">
                  <option value="">Any Level</option>
                  <option value="entry">Entry Level</option>
                  <option value="intermediate">Intermediate</option>
                  <option value="expert">Expert</option>
                </select>
              </div>

              <div class="filter-group">
                <label>Project Type</label>
                <select class="filter-select" 
                        [(ngModel)]="selectedJobType" 
                        (ngModelChange)="onJobTypeChange($event)">
                  <option value="">Any Type</option>
                  <option value="fixed">Fixed Price</option>
                  <option value="hourly">Hourly Rate</option>
                </select>
              </div>

              <div class="filter-group checkbox-group">
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="remoteOnly" (ngModelChange)="onRemoteChange($event)" />
                  <span class="checkmark"></span>
                  Remote Only
                </label>
              </div>
            </div>
          </div>

          <!-- Loading -->
          <div class="loading-state" *ngIf="loading">
            <div class="spinner"></div>
            <p>Loading jobs...</p>
          </div>

          <!-- Empty State -->
          <div class="empty-state" *ngIf="!loading && jobs.length === 0">
            <div class="empty-icon">
              <mat-icon>work</mat-icon>
            </div>
            <h3>No jobs found</h3>
            <p>Try adjusting your search or filters to find more opportunities</p>
            <button class="btn-gradient" (click)="clearFilters()">Clear Filters</button>
          </div>

          <!-- Jobs Grid -->
          <div class="jobs-grid" *ngIf="!loading && jobs.length > 0">
            <div class="job-card" *ngFor="let job of jobs" (click)="onViewJob(job)">
              <div class="card-top">
                <span class="job-category">{{ getCategoryName(job.category_id) }}</span>
                <div class="card-badges">
                  <span class="remote-badge" *ngIf="job.is_remote">üåç Remote</span>
                  <span class="job-status" [class]="job.status.toLowerCase().replace(' ', '-')">
                    {{ job.status }}
                  </span>
                </div>
              </div>

              <h3 class="job-title">{{ job.title }}</h3>
              
              <p class="job-description">
                {{ job.description | slice:0:180 }}{{ job.description.length > 180 ? '...' : '' }}
              </p>

              <!-- Job Tags -->
              <div class="job-tags" *ngIf="job.experience_level || job.job_type || (job.skills && job.skills.length)">
                <span class="tag experience" *ngIf="job.experience_level">{{ getExperienceLabel(job.experience_level) }}</span>
                <span class="tag job-type" *ngIf="job.job_type">{{ getJobTypeLabel(job.job_type) }}</span>
                <span class="tag skill" *ngFor="let skillId of (job.skills || []).slice(0, 3)">
                  {{ getSkillName(skillId) }}
                </span>
                <span class="tag more" *ngIf="job.skills && job.skills.length > 3">
                  +{{ job.skills.length - 3 }} more
                </span>
              </div>

              <div class="card-bottom">
                <div class="job-info">
                  <span class="info-item budget" *ngIf="job.budget">
                    {{ formatBudget(job.budget) }}
                  </span>
                  <span class="info-item location" *ngIf="job.location && !job.is_remote">
                    üìç {{ job.location }}
                  </span>
                  <span class="info-item deadline" *ngIf="job.deadline">
                    <mat-icon>event</mat-icon>
                    {{ job.deadline | date:'MMM d' }}
                  </span>
                </div>
                <span class="apply-link">View Details ‚Üí</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Profile Sidebar -->
        <aside class="profile-sidebar-wrapper">
          <app-profile-sidebar></app-profile-sidebar>
        </aside>
      </div>
    </div>
  </div>
</div>
