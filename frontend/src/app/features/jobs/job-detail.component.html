<div class="job-detail-page">
  <!-- Loading State -->
  <div class="loading-state" *ngIf="loading">
    <div class="spinner"></div>
    <p>Loading job details...</p>
  </div>

  <!-- Job Not Found -->
  <div class="not-found" *ngIf="!loading && !job">
    <div class="not-found-icon">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <circle cx="12" cy="12" r="10"/>
        <path d="M12 8v4M12 16h.01"/>
      </svg>
    </div>
    <h2>Job Not Found</h2>
    <p>This job posting may have been removed or doesn't exist.</p>
    <button class="btn-primary" (click)="goBack()">Browse Jobs</button>
  </div>

  <!-- Job Content -->
  <div class="job-content" *ngIf="!loading && job">
    <!-- Back Button -->
    <button class="back-btn" (click)="goBack()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      Back to Jobs
    </button>

    <div class="content-grid">
      <!-- Main Content -->
      <main class="main-section">
        <!-- Job Header -->
        <div class="job-header">
          <div class="header-top">
            <span class="job-category" *ngIf="category">{{ category.name }}</span>
            <span class="job-status" [class]="getStatusClass()">{{ job.status }}</span>
          </div>
          <h1 class="job-title">{{ job.title }}</h1>
          <div class="job-meta">
            <span class="meta-item" *ngIf="job.budget">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="1" x2="12" y2="23"/>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
              </svg>
              {{ formatBudget(job.budget) }}
            </span>
            <span class="meta-item" *ngIf="job.deadline">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
              </svg>
              Due {{ job.deadline | date:'MMM d, y' }}
            </span>
          </div>
        </div>

        <!-- Job Description -->
        <div class="job-description">
          <h2>Job Description</h2>
          <p>{{ job.description }}</p>
        </div>

        <!-- Category Info -->
        <div class="category-info" *ngIf="category">
          <h2>Category</h2>
          <div class="category-card">
            <h3>{{ category.name }}</h3>
            <p *ngIf="category.description">{{ category.description }}</p>
          </div>
        </div>
      </main>

      <!-- Sidebar -->
      <aside class="sidebar">
        <!-- Employer Card -->
        <div class="employer-card">
          <h3>About the Client</h3>
          <div class="employer-info">
            <div class="employer-avatar">
              <span class="avatar-initials">{{ getEmployerInitials() }}</span>
            </div>
            <div class="employer-details">
              <p class="employer-name">{{ getEmployerName() }}</p>
              <p class="employer-label">Employer</p>
            </div>
          </div>
        </div>

        <!-- Apply Card -->
        <div class="apply-card">
          <!-- Already Applied -->
          <div class="applied-state" *ngIf="applied">
            <div class="success-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
              </svg>
            </div>
            <h3>Application Submitted!</h3>
            <p>Your proposal has been sent to the client. You'll be notified when they respond.</p>
          </div>

          <!-- Apply Form (Freelancer Only) -->
          <div class="apply-form" *ngIf="!applied && isLoggedIn && isFreelancer && job.status === 'Open'">
            <h3>Submit a Proposal</h3>
            
            <div class="form-group">
              <label for="bidAmount">Your Bid ($)</label>
              <input 
                type="number" 
                id="bidAmount"
                [(ngModel)]="bidAmount"
                placeholder="Enter your bid amount"
                min="1"
              />
            </div>
            
            <div class="form-group">
              <label for="proposal">Cover Letter</label>
              <textarea 
                id="proposal"
                [(ngModel)]="proposalText"
                placeholder="Explain why you're the best fit for this job..."
                rows="6"
              ></textarea>
            </div>
            
            <button 
              class="btn-apply" 
              (click)="apply()"
              [disabled]="applying || !bidAmount || !proposalText.trim()">
              <span *ngIf="!applying">Submit Proposal</span>
              <span *ngIf="applying">Submitting...</span>
            </button>
          </div>

          <!-- Job Closed -->
          <div class="closed-state" *ngIf="!applied && job.status !== 'Open'">
            <h3>Job Not Available</h3>
            <p>This job is no longer accepting applications.</p>
            <button class="btn-secondary" (click)="goBack()">Browse Other Jobs</button>
          </div>

          <!-- Employer View -->
          <div class="employer-view" *ngIf="!applied && isLoggedIn && !isFreelancer && job.status === 'Open'">
            <h3>This is Your Listing</h3>
            <p>Only freelancers can submit proposals to this job.</p>
          </div>

          <!-- Guest View -->
          <div class="guest-view" *ngIf="!isLoggedIn && job.status === 'Open'">
            <h3>Want to Apply?</h3>
            <p>Create a free account to submit proposals and start working on projects.</p>
            <button class="btn-apply" (click)="showAuthModal = true">Sign Up to Apply</button>
            <p class="login-link">Already have an account? <a routerLink="/login">Log in</a></p>
          </div>
        </div>
      </aside>
    </div>
  </div>
</div>

<!-- Auth Prompt Modal -->
<app-auth-prompt-modal
  [show]="showAuthModal"
  title="Sign in to apply"
  message="Create a free account or log in to submit proposals and start working on projects."
  [returnUrl]="'/jobs/' + job?.job_id"
  (closed)="closeAuthModal()">
</app-auth-prompt-modal>
