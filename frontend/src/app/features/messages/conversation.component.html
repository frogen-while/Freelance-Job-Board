<div class="conversation-page">
  <!-- Header -->
  <div class="conversation-header">
    <button class="back-btn" (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
    </button>
    
    <div class="user-info">
      <div class="avatar">
        <span class="avatar-initials">{{ getOtherUserInitials() }}</span>
      </div>
      <span class="user-name">{{ getOtherUserName() }}</span>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="loading">
    <div class="spinner"></div>
    <p>Loading messages...</p>
  </div>

  <!-- Messages Container -->
  <div class="messages-container" #messagesContainer *ngIf="!loading">
    <!-- Empty State -->
    <div class="empty-state" *ngIf="messages.length === 0">
      <p>No messages yet. Start the conversation!</p>
    </div>

    <!-- Messages List -->
    <div class="messages-list" *ngIf="messages.length > 0">
      <ng-container *ngFor="let msg of messages; let i = index">
        <!-- Date Separator -->
        <div class="date-separator" *ngIf="shouldShowDateSeparator(i)">
          <span>{{ formatMessageDate(msg.sent_at) }}</span>
        </div>
        
        <!-- Message Bubble -->
        <div class="message" [class.own]="isOwnMessage(msg)" [class.other]="!isOwnMessage(msg)">
          <div class="message-bubble">
            <p class="message-text">{{ msg.body }}</p>
            <span class="message-time">{{ formatMessageTime(msg.sent_at) }}</span>
          </div>
        </div>
      </ng-container>
    </div>
  </div>

  <!-- Input Area -->
  <div class="input-area" *ngIf="!loading">
    <div class="input-wrapper">
      <textarea 
        [(ngModel)]="newMessage"
        placeholder="Type a message..."
        rows="1"
        (keypress)="onKeyPress($event)"
        [disabled]="sending">
      </textarea>
      <button 
        class="send-btn" 
        (click)="sendMessage()" 
        [disabled]="sending || !newMessage.trim()">
        <mat-icon *ngIf="!sending">send</mat-icon>
        <span class="sending-spinner" *ngIf="sending"></span>
      </button>
    </div>
  </div>
</div>
